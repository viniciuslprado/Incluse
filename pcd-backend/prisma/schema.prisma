generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Empresa {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String?  @unique
  cnpj      String?  @unique
  createdAt DateTime @default(now())
  isActive  Boolean  @default(true)
  updatedAt DateTime @updatedAt
  senhaHash String?
  vagas     Vaga[]
  avaliacoes Avaliacao[]
}

model TipoDeficiencia {
  id        Int                  @id @default(autoincrement())
  nome      String               @unique
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  subtipos  SubtipoDeficiencia[]
}

model SubtipoDeficiencia {
  id                 Int                        @id @default(autoincrement())
  nome               String
  tipoId             Int
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime                   @updatedAt
  candidatoSubtipos  CandidatoSubtipo[]
  candidatoBarreiras CandidatoSubtipoBarreira[]
  barreiras          SubtipoBarreira[]
  tipo               TipoDeficiencia            @relation(fields: [tipoId], references: [id], onDelete: Cascade)
  VagaSubtipo        VagaSubtipo[]

  @@unique([tipoId, nome])
}

model Barreira {
  id                 Int                        @id @default(autoincrement())
  descricao          String                     @unique
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime                   @updatedAt
  acessibilidades    BarreiraAcessibilidade[]
  candidatoBarreiras CandidatoSubtipoBarreira[]
  subtipos           SubtipoBarreira[]
}

model Acessibilidade {
  id                 Int                      @id @default(autoincrement())
  descricao          String                   @unique
  createdAt          DateTime                 @default(now())
  updatedAt          DateTime                 @updatedAt
  barreiras          BarreiraAcessibilidade[]
  VagaAcessibilidade VagaAcessibilidade[]
}

model SubtipoBarreira {
  subtipoId  Int
  barreiraId Int
  barreira   Barreira           @relation(fields: [barreiraId], references: [id], onDelete: Cascade)
  subtipo    SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)

  @@id([subtipoId, barreiraId])
  @@index([barreiraId])
}

model BarreiraAcessibilidade {
  barreiraId       Int
  acessibilidadeId Int
  acessibilidade   Acessibilidade @relation(fields: [acessibilidadeId], references: [id], onDelete: Cascade)
  barreira         Barreira       @relation(fields: [barreiraId], references: [id], onDelete: Cascade)

  @@id([barreiraId, acessibilidadeId])
  @@index([acessibilidadeId])
}

model Vaga {
  id              Int                  @id @default(autoincrement())
  empresaId       Int
  descricao       String
  escolaridade    String
  isActive        Boolean              @default(true)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  cidade          String?              @default("A definir")
  estado          String?              @default("A definir")
  titulo          String?              @default("Vaga")
  empresa         Empresa              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  acessibilidades VagaAcessibilidade[]
  subtiposAceitos VagaSubtipo[]
  vagasSalvas     VagaSalva[]
  candidaturas    Candidatura[]
}

model VagaSubtipo {
  vagaId    Int
  subtipoId Int
  subtipo   SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)
  vaga      Vaga               @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@id([vagaId, subtipoId])
  @@index([subtipoId])
}

model VagaAcessibilidade {
  vagaId           Int
  acessibilidadeId Int
  acessibilidade   Acessibilidade @relation(fields: [acessibilidadeId], references: [id], onDelete: Cascade)
  vaga             Vaga           @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@id([vagaId, acessibilidadeId])
  @@index([acessibilidadeId])
}

model Candidato {
  id           Int                        @id @default(autoincrement())
  nome         String
  email        String?                    @unique
  telefone     String?
  escolaridade String
  createdAt    DateTime                   @default(now())
  updatedAt    DateTime                   @updatedAt
  cpf          String?                    @unique
  senhaHash    String?
  subtipos     CandidatoSubtipo[]
  barras       CandidatoSubtipoBarreira[]
  vagasSalvas  VagaSalva[]
  candidaturas Candidatura[]
}

model CandidatoSubtipo {
  candidatoId Int
  subtipoId   Int
  candidato   Candidato          @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  subtipo     SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)

  @@id([candidatoId, subtipoId])
  @@index([subtipoId])
}

model CandidatoSubtipoBarreira {
  candidatoId Int
  subtipoId   Int
  barreiraId  Int
  barreira    Barreira           @relation(fields: [barreiraId], references: [id], onDelete: Cascade)
  candidato   Candidato          @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  subtipo     SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)

  @@id([candidatoId, subtipoId, barreiraId])
  @@index([subtipoId])
  @@index([barreiraId])
}


// Avaliações, vagas salvas e candidaturas
model Avaliacao {
  id         Int      @id @default(autoincrement())
  empresaId  Int
  nota       Int
  comentario String?
  anonimato  Boolean  @default(false)
  createdAt  DateTime @default(now())

  empresa    Empresa  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
}

model VagaSalva {
  candidatoId Int
  vagaId      Int
  createdAt   DateTime @default(now())

  candidato   Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  vaga        Vaga      @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@id([candidatoId, vagaId])
}

model Candidatura {
  id          Int      @id @default(autoincrement())
  vagaId      Int
  candidatoId Int
  createdAt   DateTime @default(now())

  vaga        Vaga     @relation(fields: [vagaId], references: [id], onDelete: Cascade)
  candidato   Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
}
